<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Installation Service Report</title>

<!-- Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/signature_pad/4.1.7/signature_pad.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body { font-family: Arial,sans-serif; background:#f4f6fa; margin:0; padding:0;}
.container { max-width:600px; margin:10px auto; background:#fff; padding:15px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
header { text-align:center; margin-bottom:15px; background:#0d4f8b; color:#fff; padding:10px; border-radius:6px;}
header img { max-width:100px; display:block; margin:0 auto 5px;}
header h1 { font-size:14px; margin:5px 0; color:#fff;}
header h2 { font-size:14px; margin:0; color:#fff; font-weight:normal;}
.section { margin-top:10px; padding:10px; border:1px solid #dce3ef; border-radius:6px;}
.section h3 { margin:0 0 8px 0; font-size:12px; color:#0d4f8b;}
label { font-weight:bold; display:block; margin:6px 0 2px;}
input[type=text],input[type=date],input[type=time],input[type=number] { width:95%; padding:6px; border:1px solid #ccc; border-radius:4px; font-weight:normal;}
table { width:95%; border-collapse:collapse; margin-top:6px; font-size:12px;}
th,td { border:1px solid #ccc; padding:4px; text-align:center;}
th { background:#eef6ff;}
.controls { margin-top:8px; display:flex; gap:6px; flex-wrap:wrap; justify-content:center;}
button { padding:6px 10px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; font-size:12px;}
.btn-primary { background:#0d4f8b; color:#fff;}
.btn-danger { background:#d62828; color:#fff;}
.sig-preview { margin-top:4px; max-width:120px; border:1px solid #ccc; display:block; margin-left:auto; margin-right:auto;}
.preview-container { margin-top:10px; padding:10px; border:2px dashed #0d4f8b; background:#fff; border-radius:6px;}
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000;}
.modal-inner { background:#fff; width:95%; height:85%; border-radius:8px; display:flex; flex-direction:column; padding:10px;}
.modal-inner canvas { flex:1; border:1px solid #999; }
.modal-actions { margin-top:6px; text-align:center; font-size:12px;}
.note { margin-top:6px; font-size:12px; font-style:italic; color:#333;}
</style>
</head>
<body>

<div class="container">
  <!-- Logo Centered with Background -->
  <header>
    <img src="logo.jpg" alt="Company Logo">
    <h2>"Biomedical Equipment Installation/Up-gradation/Handover-Service Report"</h2>
  </header>

  <form id="form">
    <!-- Report Info -->
    <div class="section">
      <h3>Report Information</h3>
      <label>Report No.</label>
      <input id="reportNo" type="text" readonly>
      <label>Date</label>
      <input id="date" type="date">
      <label>Time</label>
      <input id="time" type="time">
    </div>

    <!-- Equipment Info -->
    <div class="section">
      <h3>Equipment Information</h3>
      <label>Department</label>
      <input id="department" type="text">
      <label>Equipment</label>
      <input id="equipment" type="text">
      <label>Model</label>
      <input id="model" type="text">
      <label>Make</label>
      <input id="make" type="text">
      <label>Serial Number</label>
      <input id="serialNumber" type="text">
    </div>

    <!-- Accessories Table -->
    <div class="section">
      <h3>Accessories Details</h3>
      <table id="accessTable">
        <thead>
          <tr><th>S/N</th><th>Description</th><th>Qty</th><th>Serial No.</th><th>Action</th></tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="note">
        "The above Equipment / Item Installed by Biomedical Engineer has / have been handed over to the department in good working condition for use. Demonstration also given to end-user"
      </div>
      <div class="controls">
        <button type="button" class="btn-primary" onclick="addAccessory()">+ Add Accessory</button>
      </div>
    </div>

    <!-- User Details -->
    <div class="section">
      <h3>User Details</h3>
      <label>User Name</label>
      <input id="userName" type="text">
      <label>Emp. Code</label>
      <input id="userCode" type="text">
      <div class="controls">
        <button type="button" class="btn-primary" onclick="openSignature('user')">Sign (User)</button>
      </div>
      <img id="userSignImg" class="sig-preview">
    </div>

    <!-- BME Details -->
    <div class="section">
      <h3>BME Details</h3>
      <label>BME Name</label>
      <input id="bmeName" type="text">
      <label>BME Code</label>
      <input id="bmeCode" type="text">
      <div class="controls">
        <button type="button" class="btn-primary" onclick="openSignature('bme')">Sign (BME)</button>
      </div>
      <img id="bmeSignImg" class="sig-preview">
    </div>

    <!-- Form Actions -->
    <div class="controls">
      <button type="button" class="btn-primary" onclick="generatePreview()">Preview</button>
      <button type="button" class="btn-primary" onclick="downloadPDF()">Download PDF</button>
    </div>
  </form>

  <!-- Preview -->
  <div id="preview" class="preview-container"></div>
</div>

<!-- Signature Modal -->
<div id="sigModal" class="modal">
  <div class="modal-inner">
    <canvas id="sigCanvas"></canvas>
    <div class="modal-actions">
      <button class="btn-primary" onclick="acceptSignature()">Accept</button>
      <button class="btn-danger" onclick="clearSignature()">Clear</button>
      <button onclick="closeSignature()">Close</button>
    </div>
  </div>
</div>

<script>
document.getElementById('reportNo').value = "REP-" + Date.now();

function addAccessory(){
  const tbody=document.querySelector("#accessTable tbody");
  const tr=document.createElement("tr");
  tr.innerHTML=`<td><input type="text" value="${tbody.rows.length+1}"></td>
  <td><input type="text"></td><td><input type="number" value="1"></td>
  <td><input type="text"></td><td><button type="button" onclick="this.closest('tr').remove()">Delete</button></td>`;
  tbody.appendChild(tr);
}

let sigPad, signer;
function openSignature(who){
  signer=who;
  document.getElementById("sigModal").style.display="flex";
  const canvas=document.getElementById("sigCanvas");
  canvas.width=canvas.offsetWidth*2; canvas.height=canvas.offsetHeight*2;
  canvas.getContext("2d").scale(2,2);
  sigPad=new SignaturePad(canvas,{penColor:"black"});
}
function acceptSignature(){
  if(sigPad.isEmpty()){alert("Please sign first");return;}
  const data=sigPad.toDataURL();
  if(signer==="user") document.getElementById("userSignImg").src=data;
  else document.getElementById("bmeSignImg").src=data;
  closeSignature();
}
function clearSignature(){ sigPad.clear(); }
function closeSignature(){ document.getElementById("sigModal").style.display="none"; }

function buildPreview(){
  const accRows=[...document.querySelectorAll("#accessTable tbody tr")].map(r=>{
    const t=[...r.querySelectorAll("input")].map(i=>i.value);
    return `<tr><td>${t[0]}</td><td>${t[1]}</td><td>${t[2]}</td><td>${t[3]}</td></tr>`;
  }).join("");
  return `
  <div>
    <div style="text-align:center; background:#0d4f8b; color:#fff; padding:10px; border-radius:6px;">
      <img src="logo.jpg" style="max-height:50px;">
      <h3>"Biomedical Equipment Installation/Upgrade/Handover Service Report"</h3>
    </div>
    <p><b>Report No:</b> ${form.reportNo.value}</p>
    <p><b>Date:</b> ${form.date.value} &nbsp; <b>Time:</b> ${form.time.value}</p>
    <h3>Equipment Information</h3>
    <p><b>Department:</b> ${form.department.value}</p>
    <p><b>Equipment:</b> ${form.equipment.value}</p>
    <p><b>Model:</b> ${form.model.value}</p>
    <p><b>Make:</b> ${form.make.value}</p>
    <p><b>Serial No.:</b> ${form.serialNumber.value}</p>
    <h3>Accessories Details</h3>
    <table border="1" width="100%"><tr><th>S/N</th><th>Description</th><th>Qty</th><th>SN</th></tr>${accRows}</table>
    <div class="note">The above Equipment / Item Installed by Biomedical Engineer has / have been handed over to the department in good working condition. Demonstration given.</div>
    <h3>User Details</h3>
    <p><b>Name:</b> ${form.userName.value} &nbsp; <b>Emp Code:</b> ${form.userCode.value}</p>
    ${userSignImg.src?`<img src="${userSignImg.src}" width="100">`:""}
    <h3>BME Details</h3>
    <p><b>Name:</b> ${form.bmeName.value} &nbsp; <b>Code:</b> ${form.bmeCode.value}</p>
    ${bmeSignImg.src?`<img src="${bmeSignImg.src}" width="100">`:""}
  </div>`;
}

function generatePreview(){
  document.getElementById("preview").innerHTML=buildPreview();
}

async function downloadPDF(){
  generatePreview();
  const preview=document.getElementById("preview");
  const canvas=await html2canvas(preview,{scale:2});
  const img=canvas.toDataURL("image/jpeg",0.98);
  const pdf=new jspdf.jsPDF("p","mm","a4");
  const pageWidth=pdf.internal.pageSize.getWidth();
  const imgProps=pdf.getImageProperties(img);
  const pdfHeight=(imgProps.height*pageWidth)/imgProps.width;
  pdf.addImage(img,"JPEG",0,0,pageWidth,pdfHeight);
  pdf.save("Installation_Service_Report.pdf");
}
</script>

</body>
</html>
